{% extends 'main.html' %}
{% block content %}
<div class="container mt-5 text-dark" style="font-family: 'Poppins', sans-serif;">
  <h2 class="mb-4 text-center display-4 fw-bold" style="color: #2c3e50;">Your Reservations</h2>

  <form method="get" class="row g-3 mb-5 justify-content-center">
    <div class="col-md-4">
      <input type="text" name="table_name" class="form-control rounded-pill px-4 py-3 shadow-sm" placeholder="Search by table name" style="border: 1.5px solid #2980b9;">
    </div>
    <div class="col-md-3">
      <input type="date" name="start_date" class="form-control rounded-pill px-4 py-3 shadow-sm" style="border: 1.5px solid #2980b9;">
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-primary w-100 fw-semibold rounded-pill shadow-sm" style="font-weight: 600;">
        Filter
      </button>
    </div>
  </form>

  {% if reservation %}
    <div class="row g-4">
      {% for r in reservation %}
      <div class="col-md-6">
        <div class="card p-4 rounded shadow-sm" style="background: #f9f9f9; border: 1.5px solid #2980b9;">
          <div class="card-body">
            <h5 class="fw-bold mb-3" style="color: #2980b9; font-family: 'Orbitron', sans-serif; letter-spacing: 1.5px;">
              {{ r.table.name }}
            </h5>
            <p class="mb-1" style="font-size: 1.1rem; color: #34495e;">
              <strong>{{ r.reservation_start|date:"M d, Y - h:i A" }}</strong> &rarr;
              <strong>{{ r.reservation_end|date:"h:i A" }}</strong>
            </p>
            <p style="color: #34495e;">
              Guests: <span class="badge bg-info text-dark px-3 py-2 fw-semibold fs-6">{{ r.number_of_party }}</span>
            </p>

            {% if r.special_order %}
            <p class="fst-italic" style="color: #7f8c8d; border-left: 3px solid #2980b9; padding-left: 10px; margin-top: 1rem;">
              "{{ r.special_order }}"
            </p>
            {% endif %}

            <div class="accordion mt-4" id="ordersAccordion{{ forloop.counter }}">
              <div class="accordion-item">
                <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                  <button class="accordion-button collapsed fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="false" aria-controls="collapse{{ forloop.counter }}">
                    Orders ({{ r.table_orders.count }})
                  </button>
                </h2>
                <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#ordersAccordion{{ forloop.counter }}">
                  <div class="accordion-body p-3" style="color: #2c3e50;">
                    {% if r.table_orders.all %}
                      <ul class="list-group list-group-flush">
                        {% for order in r.table_orders.all %}
                        <li class="list-group-item px-0 mb-3" style="background: transparent; border: none;">
                          <h6 class="fw-bold mb-2">Order #{{ order.id }}</h6>
                          <ul class="list-unstyled ms-3">
                            {% for item in order.items.all %}
                            <li class="d-flex justify-content-between align-items-center mb-1">
                              <span>{{ item.menu_item.item_name }}</span>
                              <span class="badge bg-primary rounded-pill px-3 py-1">{{ item.quantity }}</span>
                            </li>
                            {% empty %}
                            <li class="fst-italic text-muted">No items in this order.</li>
                            {% endfor %}
                          </ul>
                        </li>
                        {% endfor %}
                      </ul>
                    {% else %}
                    <p class="text-muted fst-italic">No orders found for this reservation.</p>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>

            <div class="mt-4 d-flex justify-content-between">
              <a href="{% url 'update-reservation' r.pk %}" class="btn btn-outline-primary btn-sm fw-semibold rounded-pill px-4 py-2">
                <i class="bi bi-pencil-square me-2"></i> Edit
              </a>
              <a href="{% url 'delete-reservation' r.pk %}" class="btn btn-outline-danger btn-sm fw-semibold rounded-pill px-4 py-2">
                <i class="bi bi-trash me-2"></i> Cancel
              </a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-center fs-5 mt-5 text-muted fst-italic">No reservations found.</p>
  {% endif %}
</div>

<style>
  .btn-outline-primary:hover {
    background-color: #2980b9;
    color: #fff;
  }
  .btn-outline-danger:hover {
    background-color: #c0392b;
    color: #fff;
  }
</style>
{% endblock %}
